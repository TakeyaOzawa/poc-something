# Error Codes Usage Guide

## How to Use Error Codes

### In Code
```typescript
import { StandardError } from '@domain/entities/StandardError';

// Throw an error with context
throw new StandardError('E_XPATH_0001', {
  xpath: '//*[@id="invalid"]',
  url: 'https://example.com'
});

// Get localized messages
const error = new StandardError('E_XPATH_0001');
console.log(error.getUserMessage());        // User-friendly message
console.log(error.getDevMessage());         // Developer message
console.log(error.getResolutionMessage());  // Resolution steps
```

### Error Handling Pattern
```typescript
try {
  // Some operation that might fail
  await executeXPathOperation(xpath, url);
} catch (error) {
  if (error instanceof StandardError) {
    // Handle known application errors
    console.error('App Error:', error.getDevMessage());
    showUserNotification(error.getUserMessage());
    logErrorDetails(error.toJSON());
  } else {
    // Handle unexpected errors
    console.error('Unexpected Error:', error);
    throw new StandardError('E_USER_0001', { 
      originalError: error.message 
    });
  }
}
```

### Error Code Management

```bash
# List all error codes
npm run error:list

# Reserve new error code
npm run error:reserve XPATH

# Validate error codes
npm run error:validate

# Generate documentation
npm run error:docs
```

## Error Code Format

- **Pattern**: `E_CATEGORY_NNNN`
- **Categories**: AUTH, STORAGE, XPATH, USER, SYNC
- **Messages**: Each error code has USER, DEV, and RESOLUTION messages

### Available Categories

| Category | Purpose | Example Use Cases |
|----------|---------|-------------------|
| **AUTH** | Authentication & Authorization | Login failures, token validation, permission errors |
| **STORAGE** | Data Persistence | Chrome Storage API errors, IndexedDB issues |
| **XPATH** | XPath Operations | Element not found, selector errors, auto-fill failures |
| **USER** | User Input & Operations | Validation errors, user management |
| **SYNC** | Data Synchronization | External API sync, conflict resolution |

## Adding New Error Codes

### 1. Reserve Error Code
```bash
npm run error:reserve NETWORK
# Creates: E_NETWORK_0001
```

### 2. Update Messages
Edit `public/_locales/en/messages.json`:
```json
{
  "E_NETWORK_0001_USER": {
    "message": "Network connection failed"
  },
  "E_NETWORK_0001_DEV": {
    "message": "HTTP request failed in E_NETWORK_0001: {{statusCode}}"
  },
  "E_NETWORK_0001_RESOLUTION": {
    "message": "Check your internet connection and try again"
  }
}
```

### 3. Use in Code
```typescript
// Network service
if (response.status >= 400) {
  throw new StandardError('E_NETWORK_0001', {
    statusCode: response.status,
    url: request.url
  });
}
```

## Message Context Variables

Error messages support context variable substitution:

```typescript
throw new StandardError('E_XPATH_0001', {
  xpath: '//*[@id="username"]',
  url: 'https://example.com',
  timeout: 5000
});
```

Message template:
```json
{
  "E_XPATH_0001_DEV": {
    "message": "XPath '{{xpath}}' not found on {{url}} after {{timeout}}ms"
  }
}
```

## Automatic Documentation Updates

The error code documentation is automatically updated when:

- `public/_locales/*/messages.json` files are modified
- `src/domain/entities/StandardError.ts` is updated
- `src/domain/types/i18n-port.type.ts` is changed

This is handled by the Kiro Agent Hook: `.kiro/hooks/error-codes-update.json`

## Best Practices

### 1. Error Message Guidelines
- **USER**: Clear, actionable, non-technical
- **DEV**: Include error code, technical context
- **RESOLUTION**: Step-by-step troubleshooting

### 2. Context Variables
- Use meaningful variable names
- Include relevant debugging information
- Avoid sensitive data (passwords, tokens)

### 3. Error Categories
- Use existing categories when possible
- Create new categories for distinct error domains
- Follow naming convention: UPPERCASE_UNDERSCORE

### 4. Testing
- Test error scenarios in unit tests
- Verify message localization
- Ensure context variables are properly substituted

---
*This documentation is automatically generated by `npm run error:docs` command.*
*Generated on: 2024-12-24 11:30:00 UTC*
*Triggered by: Kiro Agent Hook on file save*
*Source: scripts/coding-helpers/validate-and-test.sh generate-docs*
