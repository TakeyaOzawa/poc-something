# ADR-001: クリーンアーキテクチャの採用

## ステータス

承認済み

## コンテキスト

プロジェクトの初期段階で、長期的な保守性と拡張性を確保するためのアーキテクチャパターンを選択する必要がありました。Chrome拡張機能という特殊な環境でありながら、ビジネスロジックを技術的詳細から分離し、テスタビリティを向上させる必要がありました。

## 決定

クリーンアーキテクチャを採用し、以下の4層構造を実装します：

1. **Domain層**: ビジネスロジックとエンティティ
2. **Application層**: ユースケースとDTO
3. **Infrastructure層**: 技術的実装（Repository、Adapter）
4. **Presentation層**: UI（Popup、Content Script、Background）

## 理由

### 1. 依存関係の制御

- 依存関係逆転の原則（DIP）により、Domain層が外部に依存しない
- Infrastructure層とPresentation層がDomain層に依存する一方向の依存関係

### 2. テスタビリティ

- ビジネスロジックを独立してテスト可能
- モックやスタブを使用した単体テストが容易

### 3. 保守性

- 各層の責務が明確
- 変更の影響範囲が限定的

### 4. 拡張性

- 新しい機能の追加が容易
- 技術スタックの変更が容易（例: ストレージの変更）

## 結果

### ポジティブな影響

- ビジネスロジックが技術的詳細から完全に分離された
- テストカバレッジが向上（5221個のテスト）
- 新機能の追加が容易になった
- チーム内でアーキテクチャの理解が統一された

### ネガティブな影響

- 初期の学習コストが高い
- ボイラープレートコードが増加（DTO、Mapper等）
- 小さな変更でも複数の層を修正する必要がある場合がある

### トレードオフ

- **複雑性 vs 保守性**: 短期的には複雑だが、長期的には保守性が向上
- **開発速度 vs 品質**: 初期開発は遅いが、品質が高く、後の変更が容易

## 代替案

### 代替案1: MVC/MVVMパターン

- **説明**: 従来のMVC/MVVMパターンを使用
- **メリット**: シンプル、学習コストが低い
- **デメリット**: ビジネスロジックとUIが密結合、テストが困難
- **却下理由**: 長期的な保守性が低い

### 代替案2: レイヤードアーキテクチャ

- **説明**: 単純な3層アーキテクチャ（UI、Business、Data）
- **メリット**: シンプル、理解しやすい
- **デメリット**: 依存関係の制御が弱い、テスタビリティが低い
- **却下理由**: 依存関係逆転の原則が適用されない

### 代替案3: マイクロサービスアーキテクチャ

- **説明**: 機能ごとに独立したサービスに分割
- **メリット**: 完全な独立性、スケーラビリティ
- **デメリット**: Chrome拡張機能には過剰、複雑性が高い
- **却下理由**: プロジェクトの規模に対して過剰

## 関連する決定

- ADR-002: ヘキサゴナルアーキテクチャの採用
- ADR-003: DDDの採用

## 参考資料

- Clean Architecture (Robert C. Martin)
- https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html

---

日付: 2024-11-22  
作成者: Architecture Team  
レビュアー: Development Team
