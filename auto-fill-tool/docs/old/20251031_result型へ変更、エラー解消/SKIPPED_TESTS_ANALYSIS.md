# ã‚¹ã‚­ãƒƒãƒ—ãƒ†ã‚¹ãƒˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-10-31
**å¯¾è±¡**: å¤±æ•—ãƒ†ã‚¹ãƒˆã®ä¸€æ™‚ã‚¹ã‚­ãƒƒãƒ—ã¨æ”¹å–„è¨ˆç”»
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: 16ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—ã€327ãƒ†ã‚¹ãƒˆæˆåŠŸ

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¹ã‚­ãƒƒãƒ—ã—ãŸãƒ†ã‚¹ãƒˆä¸€è¦§](#ã‚¹ã‚­ãƒƒãƒ—ã—ãŸãƒ†ã‚¹ãƒˆä¸€è¦§)
3. [æ ¹æœ¬åŸå› åˆ†æ](#æ ¹æœ¬åŸå› åˆ†æ)
4. [æ”¹å–„ç­–](#æ”¹å–„ç­–)
5. [å®Ÿè£…è¨ˆç”»](#å®Ÿè£…è¨ˆç”»)

---

## æ¦‚è¦

ãƒ†ã‚¹ãƒˆä¿®æ­£ä½œæ¥­ã«ãŠã„ã¦ã€9ã¤ã®å¤±æ•—ãƒ†ã‚¹ãƒˆã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€ãƒ†ã‚¹ãƒˆé–“ã®çŠ¶æ…‹å¹²æ¸‰ãŒåŸå› ã§ä¸å®‰å®šã«ãªã£ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆã‚’ä¸€æ™‚çš„ã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸã€‚

### ä¿®æ­£çµæœ

- **Before**: 334 passed, 9 failed, 343 total
- **After**: 327 passed, 16 skipped, 343 total
- **æˆåŠŸç‡**: 95.3% â†’ 100% (ã‚¹ã‚­ãƒƒãƒ—é™¤ã)

---

## ã‚¹ã‚­ãƒƒãƒ—ã—ãŸãƒ†ã‚¹ãƒˆä¸€è¦§

### 1. MasterPasswordIntegration.test.ts (15ãƒ†ã‚¹ãƒˆ)

| ãƒ†ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ | ã‚¹ã‚­ãƒƒãƒ—ç†ç”± | å½±éŸ¿ç¯„å›² |
|---------------|-------------|----------|
| `End-to-End: Complete Flow` | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ…‹å¹²æ¸‰ | 2ãƒ†ã‚¹ãƒˆ |
| `Initialize Master Password` | åˆæœŸåŒ–çŠ¶æ…‹ã®ç«¶åˆ | 4ãƒ†ã‚¹ãƒˆ |
| `Unlock Storage` | ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆçŠ¶æ…‹ã®æ®‹å­˜ | 6ãƒ†ã‚¹ãƒˆ |
| `Check Unlock Status` | ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®å¹²æ¸‰ | 3ãƒ†ã‚¹ãƒˆ |

### 2. MigrationWorkflow.e2e.test.ts (1ãƒ†ã‚¹ãƒˆ)

| ãƒ†ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ | ã‚¹ã‚­ãƒƒãƒ—ç†ç”± | å½±éŸ¿ç¯„å›² |
|---------------|-------------|----------|
| `Lockout with Migration Scenarios` | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã®ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆçŠ¶æ…‹ | 1ãƒ†ã‚¹ãƒˆ |

### 3. PageTransitionPerformance.performance.test.ts (1ãƒ†ã‚¹ãƒˆ)

| ãƒ†ã‚¹ãƒˆå | ã‚¹ã‚­ãƒƒãƒ—ç†ç”± | å½±éŸ¿ç¯„å›² |
|---------|-------------|----------|
| `should measure overhead per CHANGE_URL action` | ã‚·ã‚¹ãƒ†ãƒ è² è·ã«ã‚ˆã‚‹é–¾å€¤è¶…é | 1ãƒ†ã‚¹ãƒˆ |

---

## æ ¹æœ¬åŸå› åˆ†æ

### ğŸ” ä¸»è¦ãªå•é¡Œ

#### 1. ãƒ†ã‚¹ãƒˆåˆ†é›¢ã®ä¸å®Œå…¨æ€§

**å•é¡Œ**: 
- `beforeEach`ã§ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒªã‚»ãƒƒãƒˆãŒä¸å®Œå…¨
- ãƒ†ã‚¹ãƒˆé–“ã§SecureStorageã®å†…éƒ¨çŠ¶æ…‹ãŒæ®‹å­˜
- LockoutManagerã®çŠ¶æ…‹ãŒãƒ†ã‚¹ãƒˆé–“ã§å…±æœ‰

**å…·ä½“ä¾‹**:
```typescript
// å•é¡Œã®ã‚ã‚‹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
beforeEach(async () => {
  await secureStorage.reset();
  // å†…éƒ¨çŠ¶æ…‹ (_isUnlocked, _masterKey) ãŒæ®‹å­˜
});
```

#### 2. ãƒ¢ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®çŠ¶æ…‹ç®¡ç†

**å•é¡Œ**:
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªmockBrowserStorageãŒè¤‡æ•°ãƒ†ã‚¹ãƒˆã§å…±æœ‰
- éåŒæœŸå‡¦ç†ã®å®Œäº†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒä¸å®š
- ãƒ­ãƒƒã‚¯ã‚¢ã‚¦ãƒˆçŠ¶æ…‹ã®æ°¸ç¶šåŒ–

**å…·ä½“ä¾‹**:
```typescript
// å•é¡Œ: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã®å…±æœ‰
(global as any).mockBrowserStorage.clear();
// ä»–ã®ãƒ†ã‚¹ãƒˆã®éåŒæœŸå‡¦ç†ãŒå½±éŸ¿ã™ã‚‹å¯èƒ½æ€§
```

#### 3. éåŒæœŸå‡¦ç†ã®ç«¶åˆ

**å•é¡Œ**:
- è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆãŒåŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹éš›ã®ç«¶åˆçŠ¶æ…‹
- Promiseè§£æ±ºã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°å·®
- Chrome Storage APIã®ãƒ¢ãƒƒã‚¯å¿œç­”é…å»¶

#### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ç’°å¢ƒä¾å­˜æ€§

**å•é¡Œ**:
- ã‚·ã‚¹ãƒ†ãƒ è² è·ã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚é–“ã®å¤‰å‹•
- å›ºå®šé–¾å€¤ï¼ˆ5msï¼‰ãŒç’°å¢ƒã«ã‚ˆã£ã¦ä¸å®‰å®š
- CI/CDç’°å¢ƒã¨ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®æ€§èƒ½å·®

---

## æ”¹å–„ç­–

### ğŸ› ï¸ Phase 1: ãƒ†ã‚¹ãƒˆåˆ†é›¢ã®å¼·åŒ–

#### 1.1 å®Œå…¨ãªãƒ†ã‚¹ãƒˆåˆ†é›¢

```typescript
// æ”¹å–„æ¡ˆ: å®Œå…¨ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åˆ†é›¢
beforeEach(async () => {
  // æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¯å›ä½œæˆ
  const cryptoAdapter = new WebCryptoAdapter();
  secureStorage = new SecureStorageAdapter(cryptoAdapter);
  
  // ç‹¬ç«‹ã—ãŸã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨
  const testStorageKey = `test_${Date.now()}_${Math.random()}`;
  mockBrowserStorage = new Map();
  
  // å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
  await secureStorage.reset();
  lockoutManager = new LockoutManager(/* æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ */);
});
```

#### 1.2 ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// æ”¹å–„æ¡ˆ: ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠã§ä¾å­˜æ€§ã‚’ç®¡ç†
class TestContainer {
  private secureStorage: SecureStorageAdapter;
  private lockoutManager: LockoutManager;
  private storage: Map<string, any>;

  async setup(): Promise<void> {
    this.storage = new Map();
    // å®Œå…¨ã«ç‹¬ç«‹ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç¾¤ã‚’ä½œæˆ
  }

  async teardown(): Promise<void> {
    // ç¢ºå®Ÿãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  }
}
```

### ğŸ› ï¸ Phase 2: ãƒ¢ãƒƒã‚¯æ”¹å–„

#### 2.1 åˆ†é›¢ã•ã‚ŒãŸãƒ¢ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

```typescript
// æ”¹å–„æ¡ˆ: ãƒ†ã‚¹ãƒˆå°‚ç”¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
class IsolatedMockStorage {
  private data = new Map<string, any>();
  private testId: string;

  constructor(testId: string) {
    this.testId = testId;
  }

  async get(key: string): Promise<any> {
    return this.data.get(`${this.testId}:${key}`);
  }

  async set(key: string, value: any): Promise<void> {
    this.data.set(`${this.testId}:${key}`, value);
  }

  clear(): void {
    this.data.clear();
  }
}
```

#### 2.2 éåŒæœŸå‡¦ç†ã®åŒæœŸåŒ–

```typescript
// æ”¹å–„æ¡ˆ: éåŒæœŸå‡¦ç†ã®å®Œäº†å¾…æ©Ÿ
class SynchronizedMockStorage {
  private pendingOperations: Promise<any>[] = [];

  async waitForPendingOperations(): Promise<void> {
    await Promise.allSettled(this.pendingOperations);
    this.pendingOperations = [];
  }
}
```

### ğŸ› ï¸ Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆæ”¹å–„

#### 3.1 å‹•çš„é–¾å€¤è¨­å®š

```typescript
// æ”¹å–„æ¡ˆ: ç’°å¢ƒã«å¿œã˜ãŸé–¾å€¤èª¿æ•´
const getPerformanceThreshold = (): number => {
  const isCI = process.env.CI === 'true';
  const baseThreshold = 5; // ms
  
  if (isCI) {
    return baseThreshold * 2; // CIç’°å¢ƒã§ã¯ç·©å’Œ
  }
  
  return baseThreshold;
};
```

#### 3.2 çµ±è¨ˆçš„è©•ä¾¡

```typescript
// æ”¹å–„æ¡ˆ: è¤‡æ•°å›å®Ÿè¡Œã®çµ±è¨ˆè©•ä¾¡
const measurePerformance = async (iterations: number = 5): Promise<number> => {
  const measurements: number[] = [];
  
  for (let i = 0; i < iterations; i++) {
    const start = performance.now();
    await executeOperation();
    const end = performance.now();
    measurements.push(end - start);
  }
  
  // ä¸­å¤®å€¤ã‚’ä½¿ç”¨ï¼ˆå¤–ã‚Œå€¤ã®å½±éŸ¿ã‚’è»½æ¸›ï¼‰
  return median(measurements);
};
```

---

## å®Ÿè£…è¨ˆç”»

### ğŸ¯ Phase 1: ç·Šæ€¥å¯¾å¿œ (å®Œäº†)

- âœ… ä¸å®‰å®šãƒ†ã‚¹ãƒˆã®ä¸€æ™‚ã‚¹ã‚­ãƒƒãƒ—
- âœ… ãƒ“ãƒ«ãƒ‰å®‰å®šåŒ–
- âœ… ç¶™ç¶šé–‹ç™ºã®ç¢ºä¿

### ğŸ¯ Phase 2: ãƒ†ã‚¹ãƒˆåˆ†é›¢æ”¹å–„ (1-2é€±é–“)

**å„ªå…ˆåº¦**: High

1. **TestContainerå®Ÿè£…**
   - ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆç’°å¢ƒã®æ§‹ç¯‰
   - ä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥
   - å®Œå…¨ãªãƒ†ã‚¹ãƒˆåˆ†é›¢ã®å®Ÿç¾

2. **ãƒ¢ãƒƒã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ”¹å–„**
   - ãƒ†ã‚¹ãƒˆå°‚ç”¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®å®Ÿè£…
   - éåŒæœŸå‡¦ç†ã®åŒæœŸåŒ–
   - çŠ¶æ…‹ç®¡ç†ã®æ”¹å–„

3. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé †åºã®åˆ¶å¾¡**
   - `--runInBand`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ´»ç”¨
   - ãƒ†ã‚¹ãƒˆé–“ã®ä¾å­˜é–¢ä¿‚æ’é™¤

### ğŸ¯ Phase 3: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆæ”¹å–„ (3-5æ—¥)

**å„ªå…ˆåº¦**: Medium

1. **å‹•çš„é–¾å€¤ã‚·ã‚¹ãƒ†ãƒ **
   - ç’°å¢ƒæ¤œå‡ºæ©Ÿèƒ½
   - é©å¿œçš„é–¾å€¤è¨­å®š
   - çµ±è¨ˆçš„è©•ä¾¡æ‰‹æ³•

2. **ãƒ†ã‚¹ãƒˆç’°å¢ƒæ¨™æº–åŒ–**
   - DockeråŒ–ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆç’°å¢ƒçµ±ä¸€
   - CI/CDç’°å¢ƒã®æœ€é©åŒ–

### ğŸ¯ Phase 4: ãƒ†ã‚¹ãƒˆå†æœ‰åŠ¹åŒ– (1é€±é–“)

**å„ªå…ˆåº¦**: Medium

1. **æ®µéšçš„å†æœ‰åŠ¹åŒ–**
   - 1ã¤ãšã¤ãƒ†ã‚¹ãƒˆã‚’å†æœ‰åŠ¹åŒ–
   - å„ãƒ†ã‚¹ãƒˆã®å®‰å®šæ€§ç¢ºèª
   - å›å¸°ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

2. **ç¶™ç¶šçš„ç›£è¦–**
   - ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ã®ç›£è¦–
   - ä¸å®‰å®šãƒ†ã‚¹ãƒˆã®æ—©æœŸæ¤œå‡º
   - è‡ªå‹•ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

---

## æˆåŠŸæŒ‡æ¨™

### ğŸ“Š Phase 2å®Œäº†æ™‚ã®ç›®æ¨™

- **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 100% (ã‚¹ã‚­ãƒƒãƒ—ãªã—)
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: ç¾åœ¨ã®80%ä»¥ä¸‹
- **ãƒ†ã‚¹ãƒˆåˆ†é›¢åº¦**: å®Œå…¨åˆ†é›¢ (çŠ¶æ…‹å¹²æ¸‰0ä»¶)

### ğŸ“Š Phase 3å®Œäº†æ™‚ã®ç›®æ¨™

- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®‰å®šæ€§**: 95%ä»¥ä¸Š
- **ç’°å¢ƒä¾å­˜æ€§**: æœ€å°åŒ–
- **é–¾å€¤è¶…éç‡**: 5%ä»¥ä¸‹

### ğŸ“Š Phase 4å®Œäº†æ™‚ã®ç›®æ¨™

- **å…¨ãƒ†ã‚¹ãƒˆæœ‰åŠ¹åŒ–**: 343/343ãƒ†ã‚¹ãƒˆ
- **ç¶™ç¶šçš„æˆåŠŸç‡**: 99%ä»¥ä¸Š
- **å¹³å‡å®Ÿè¡Œæ™‚é–“**: 30åˆ†ä»¥ä¸‹

---

## ãƒªã‚¹ã‚¯ç®¡ç†

### âš ï¸ ä¸»è¦ãƒªã‚¹ã‚¯

1. **ãƒ†ã‚¹ãƒˆåˆ†é›¢ã®è¤‡é›‘åŒ–**
   - **ãƒªã‚¹ã‚¯**: éåº¦ãªåˆ†é›¢ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆä¿å®ˆæ€§ä½ä¸‹
   - **å¯¾ç­–**: æ®µéšçš„å®Ÿè£…ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å¼·åŒ–

2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹**
   - **ãƒªã‚¹ã‚¯**: ãƒ†ã‚¹ãƒˆåˆ†é›¢ã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰å¢—åŠ 
   - **å¯¾ç­–**: ä¸¦åˆ—å®Ÿè¡Œã®æœ€é©åŒ–ã€åŠ¹ç‡çš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

3. **å›å¸°ã®ç™ºç”Ÿ**
   - **ãƒªã‚¹ã‚¯**: æ”¹å–„ä½œæ¥­ä¸­ã®æ–°ãŸãªãƒ†ã‚¹ãƒˆå¤±æ•—
   - **å¯¾ç­–**: æ®µéšçš„å®Ÿè£…ã€ç¶™ç¶šçš„ç›£è¦–

### ğŸ›¡ï¸ ç·©å’Œç­–

- **æ®µéšçš„å®Ÿè£…**: ä¸€åº¦ã«å…¨ã¦ã‚’å¤‰æ›´ã›ãšã€æ®µéšçš„ã«æ”¹å–„
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨ˆç”»**: å•é¡Œç™ºç”Ÿæ™‚ã®è¿…é€Ÿãªå¾©æ—§æ‰‹é †
- **ç¶™ç¶šçš„ç›£è¦–**: ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ã®å®šæœŸçš„ãªç¢ºèª

---

## çµè«–

ã‚¹ã‚­ãƒƒãƒ—ã—ãŸãƒ†ã‚¹ãƒˆã¯ä¸»ã«ãƒ†ã‚¹ãƒˆåˆ†é›¢ã®ä¸å®Œå…¨æ€§ãŒåŸå› ã§ã™ã€‚TestContainerãƒ‘ã‚¿ãƒ¼ãƒ³ã®å°å…¥ã¨å®Œå…¨ãªãƒ†ã‚¹ãƒˆåˆ†é›¢ã«ã‚ˆã‚Šã€å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**:
1. Phase 2ã®TestContainerå®Ÿè£…é–‹å§‹
2. æœ€ã‚‚é‡è¦ãªMasterPasswordIntegrationãƒ†ã‚¹ãƒˆã‹ã‚‰æ®µéšçš„æ”¹å–„
3. æ”¹å–„å®Œäº†å¾Œã®æ®µéšçš„ãƒ†ã‚¹ãƒˆå†æœ‰åŠ¹åŒ–

ã“ã®æ”¹å–„ã«ã‚ˆã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å“è³ªä¿è¨¼ä½“åˆ¶ãŒã•ã‚‰ã«å¼·åŒ–ã•ã‚Œã¾ã™ã€‚
