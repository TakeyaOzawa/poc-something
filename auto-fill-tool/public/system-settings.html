<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="systemSettings">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</title>
  <link rel="stylesheet" href="styles/design-system.css">
  <script defer src="vendor/alpine.min.js"></script>
</head>
<body style="background: var(--color-background); min-height: 100vh;">
  <div x-data="systemSettingsApp()" class="min-h-screen">
    
    <!-- Header -->
    <header class="nav-header">
      <div class="flex items-center gap-3">
        <a href="popup.html" class="nav-back">
          <span>â†</span>
          <span data-i18n="back">æˆ»ã‚‹</span>
        </a>
        <div class="nav-title">
          <span>âš™ï¸</span>
          <span data-i18n="systemSettings">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span>
        </div>
      </div>
      <div class="nav-actions">
        <button class="btn btn-secondary btn-sm" @click="importSettings()">
          <span>ğŸ“¥</span>
          <span data-i18n="import">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</span>
        </button>
        <button class="btn btn-secondary btn-sm" @click="exportSettings()">
          <span>ğŸ“¤</span>
          <span data-i18n="export">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</span>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container py-6">
      <div class="tab-container">
        
        <!-- Tab Navigation -->
        <nav class="tab-nav">
          <button 
            class="tab-button"
            :class="{ 'active': activeTab === 'general' }"
            @click="activeTab = 'general'"
          >
            <span>âš™ï¸</span>
            <span data-i18n="generalSettings">ä¸€èˆ¬è¨­å®š</span>
          </button>
          <button 
            class="tab-button"
            :class="{ 'active': activeTab === 'retry' }"
            @click="activeTab = 'retry'"
          >
            <span>ğŸ”„</span>
            <span data-i18n="retrySettings">ãƒªãƒˆãƒ©ã‚¤è¨­å®š</span>
          </button>
          <button 
            class="tab-button"
            :class="{ 'active': activeTab === 'security' }"
            @click="activeTab = 'security'"
          >
            <span>ğŸ”</span>
            <span data-i18n="securitySettings">ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š</span>
          </button>
        </nav>

        <!-- General Settings Tab -->
        <div class="tab-content" :class="{ 'active': activeTab === 'general' }">
          <div class="space-y-8">
            
            <!-- Language Settings -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸŒ</span>
                <span data-i18n="languageSettings">è¨€èªè¨­å®š</span>
              </h3>
              <div class="card">
                <div class="card-body">
                  <div class="form-group">
                    <label class="form-label" data-i18n="language">è¨€èª</label>
                    <select class="form-select" x-model="settings.language">
                      <option value="ja">æ—¥æœ¬èª</option>
                      <option value="en">English</option>
                    </select>
                  </div>
                </div>
              </div>
            </section>

            <!-- Theme Settings -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ¨</span>
                <span data-i18n="themeSettings">ãƒ†ãƒ¼ãƒè¨­å®š</span>
              </h3>
              <div class="card">
                <div class="card-body">
                  <div class="form-group">
                    <label class="form-label" data-i18n="theme">ãƒ†ãƒ¼ãƒ</label>
                    <select class="form-select" x-model="settings.theme">
                      <option value="light" data-i18n="themeLight">ãƒ©ã‚¤ãƒˆ</option>
                      <option value="dark" data-i18n="themeDark">ãƒ€ãƒ¼ã‚¯</option>
                      <option value="system" data-i18n="themeSystem">ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«å¾“ã†</option>
                    </select>
                  </div>
                </div>
              </div>
            </section>

            <!-- Notification Settings -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ””</span>
                <span data-i18n="notificationSettings">é€šçŸ¥è¨­å®š</span>
              </h3>
              <div class="card">
                <div class="card-body space-y-4">
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.notifications.onComplete">
                    <label data-i18n="notifyOnComplete">å®Ÿè¡Œå®Œäº†æ™‚ã«é€šçŸ¥ã‚’è¡¨ç¤º</label>
                  </div>
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.notifications.onError">
                    <label data-i18n="notifyOnError">ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«é€šçŸ¥ã‚’è¡¨ç¤º</label>
                  </div>
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.notifications.onLongRunning">
                    <label data-i18n="notifyOnLongRunning">é•·æ™‚é–“å®Ÿè¡Œæ™‚ï¼ˆ5åˆ†ä»¥ä¸Šï¼‰ã«é€²æ—é€šçŸ¥</label>
                  </div>
                  <div class="form-group">
                    <label class="form-label" data-i18n="notificationSound">é€šçŸ¥éŸ³</label>
                    <select class="form-select" x-model="settings.notifications.sound">
                      <option value="enabled" data-i18n="enabled">æœ‰åŠ¹</option>
                      <option value="disabled" data-i18n="disabled">ç„¡åŠ¹</option>
                    </select>
                  </div>
                </div>
              </div>
            </section>

            <!-- Display Settings -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ–¥ï¸</span>
                <span data-i18n="displaySettings">è¡¨ç¤ºè¨­å®š</span>
              </h3>
              <div class="card">
                <div class="card-body space-y-4">
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.display.autoRefresh">
                    <label data-i18n="autoRefreshOnStartup">ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—èµ·å‹•æ™‚ã«ã‚µã‚¤ãƒˆä¸€è¦§ã‚’è‡ªå‹•æ›´æ–°</label>
                  </div>
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.display.debugMode">
                    <label data-i18n="debugMode">ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆè©³ç´°ãƒ­ã‚°è¡¨ç¤ºï¼‰</label>
                  </div>
                  <div class="form-group">
                    <label class="form-label" data-i18n="historyRetention">å®Ÿè¡Œå±¥æ­´ã®ä¿æŒæœŸé–“</label>
                    <select class="form-select" x-model="settings.display.historyRetention">
                      <option value="7" data-i18n="days7">7æ—¥</option>
                      <option value="14" data-i18n="days14">14æ—¥</option>
                      <option value="30" data-i18n="days30">30æ—¥</option>
                      <option value="60" data-i18n="days60">60æ—¥</option>
                      <option value="-1" data-i18n="unlimited">ç„¡åˆ¶é™</option>
                    </select>
                  </div>
                </div>
              </div>
            </section>

          </div>
        </div>

        <!-- Retry Settings Tab -->
        <div class="tab-content" :class="{ 'active': activeTab === 'retry' }">
          <div class="space-y-8">
            
            <!-- Retry Behavior -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ”„</span>
                <span data-i18n="retryBehavior">ãƒªãƒˆãƒ©ã‚¤å‹•ä½œ</span>
              </h3>
              <div class="card">
                <div class="card-body">
                  <div class="form-group">
                    <label class="form-label" data-i18n="retryCount">ãƒªãƒˆãƒ©ã‚¤å›æ•°</label>
                    <select class="form-select" x-model="settings.retry.count">
                      <option value="0">0å›</option>
                      <option value="1">1å›</option>
                      <option value="2">2å›</option>
                      <option value="3">3å›</option>
                      <option value="5">5å›</option>
                      <option value="10">10å›</option>
                      <option value="-1" data-i18n="infinite">ç„¡é™å›</option>
                    </select>
                    <div class="text-caption mt-2 p-3 rounded" style="background: var(--color-warning); color: var(--color-warning);">
                      <span>âš ï¸</span>
                      <span data-i18n="infiniteRetryWarning">ç„¡é™å›ã«è¨­å®šã™ã‚‹ã¨ã€æˆåŠŸã™ã‚‹ã¾ã§ãƒªãƒˆãƒ©ã‚¤ã—ç¶šã‘ã¾ã™ã€‚ãƒªã‚¹ã‚¯: ç„¡é™ãƒ«ãƒ¼ãƒ—ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Retry Wait Time -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>â±ï¸</span>
                <span data-i18n="retryWaitTime">ãƒªãƒˆãƒ©ã‚¤å¾…æ©Ÿæ™‚é–“</span>
              </h3>
              <div class="card">
                <div class="card-body space-y-4">
                  <div class="form-group">
                    <label class="form-label" data-i18n="minWaitTime">æœ€å°å¾…æ©Ÿæ™‚é–“ï¼ˆç§’ï¼‰</label>
                    <input type="number" class="form-input" x-model="settings.retry.minWait" min="1" max="300">
                  </div>
                  <div class="form-group">
                    <label class="form-label" data-i18n="maxWaitTime">æœ€å¤§å¾…æ©Ÿæ™‚é–“ï¼ˆç§’ï¼‰</label>
                    <input type="number" class="form-input" x-model="settings.retry.maxWait" min="1" max="300">
                  </div>
                  <div class="text-caption p-3 rounded" style="background: var(--color-info); color: var(--color-info);">
                    <div class="mb-2">
                      <span>â„¹ï¸</span>
                      <span data-i18n="retryWaitExplanation">ãƒªãƒˆãƒ©ã‚¤æ™‚ã«ãƒ©ãƒ³ãƒ€ãƒ ãªå¾…æ©Ÿæ™‚é–“ã‚’è¨­å®šã—ã¾ã™ï¼ˆã‚¢ãƒ³ãƒãƒœãƒƒãƒˆå¯¾ç­–ï¼‰</span>
                    </div>
                    <div>
                      <span data-i18n="retryWaitExample">ä¾‹: æœ€å°30ç§’ã€æœ€å¤§60ç§’ã®å ´åˆ â†’ 30ã€œ60ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ™‚é–“å¾…æ©Ÿã—ã¾ã™</span>
                    </div>
                  </div>
                </div>
              </div>
            </section>

          </div>
        </div>

        <!-- Security Settings Tab -->
        <div class="tab-content" :class="{ 'active': activeTab === 'security' }">
          <div class="space-y-8">
            
            <!-- Master Password -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ”‘</span>
                <span data-i18n="masterPassword">ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</span>
              </h3>
              <div class="card">
                <div class="card-body">
                  <div class="flex items-center justify-between mb-4">
                    <div>
                      <div class="text-body mb-1" data-i18n="masterPasswordStatus">ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</div>
                      <div class="flex items-center gap-2">
                        <span class="status-badge status-success">
                          <span>âœ“</span>
                          <span data-i18n="configured">è¨­å®šæ¸ˆã¿</span>
                        </span>
                      </div>
                    </div>
                    <div class="flex gap-2">
                      <button class="btn btn-secondary btn-sm" @click="changeMasterPassword()">
                        <span>ğŸ”„</span>
                        <span data-i18n="change">å¤‰æ›´</span>
                      </button>
                      <button class="btn btn-danger btn-sm" @click="removeMasterPassword()">
                        <span>ğŸ—‘ï¸</span>
                        <span data-i18n="remove">å‰Šé™¤</span>
                      </button>
                    </div>
                  </div>
                  <div class="text-caption p-3 rounded" style="background: var(--color-info); color: var(--color-info);">
                    <span>â„¹ï¸</span>
                    <span data-i18n="masterPasswordInfo">ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¤‰æ•°ã®æš—å·åŒ–ã«ä½¿ç”¨ã•ã‚Œã¾ã™</span>
                  </div>
                </div>
              </div>
            </section>

            <!-- Auto Lock -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ”’</span>
                <span data-i18n="autoLock">è‡ªå‹•ãƒ­ãƒƒã‚¯</span>
              </h3>
              <div class="card">
                <div class="card-body space-y-4">
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.security.autoLock.enabled">
                    <label data-i18n="enableAutoLock">è‡ªå‹•ãƒ­ãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–</label>
                  </div>
                  <div class="form-group" x-show="settings.security.autoLock.enabled">
                    <label class="form-label" data-i18n="lockTimeout">ãƒ­ãƒƒã‚¯ã¾ã§ã®æ™‚é–“</label>
                    <select class="form-select" x-model="settings.security.autoLock.timeout">
                      <option value="1" data-i18n="minutes1">1åˆ†</option>
                      <option value="5" data-i18n="minutes5">5åˆ†</option>
                      <option value="15" data-i18n="minutes15">15åˆ†</option>
                      <option value="30" data-i18n="minutes30">30åˆ†</option>
                      <option value="60" data-i18n="minutes60">60åˆ†</option>
                      <option value="-1" data-i18n="never">ãªã—</option>
                    </select>
                  </div>
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.security.autoLock.onBrowserClose">
                    <label data-i18n="lockOnBrowserClose">ãƒ–ãƒ©ã‚¦ã‚¶çµ‚äº†æ™‚ã«ãƒ­ãƒƒã‚¯</label>
                  </div>
                </div>
              </div>
            </section>

            <!-- Data Protection -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ›¡ï¸</span>
                <span data-i18n="dataProtection">ãƒ‡ãƒ¼ã‚¿ä¿è­·</span>
              </h3>
              <div class="card">
                <div class="card-body space-y-4">
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.security.encryption.enabled">
                    <label data-i18n="enableEncryption">å¤‰æ•°ã®æš—å·åŒ–ã‚’æœ‰åŠ¹åŒ–ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿…é ˆï¼‰</label>
                  </div>
                  <div class="form-checkbox">
                    <input type="checkbox" x-model="settings.security.clipboard.autoClear">
                    <label data-i18n="autoClearClipboard">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å±¥æ­´ã‚’5åˆ†å¾Œã«è‡ªå‹•å‰Šé™¤</label>
                  </div>
                  <div class="form-group">
                    <label class="form-label" data-i18n="backupLocation">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä¿å­˜å…ˆ</label>
                    <select class="form-select" x-model="settings.security.backup.location">
                      <option value="local" data-i18n="localOnly">ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿</option>
                      <option value="chrome-sync" data-i18n="chromeSync">ChromeåŒæœŸ</option>
                      <option value="external" data-i18n="externalStorage">å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</option>
                    </select>
                  </div>
                </div>
              </div>
            </section>

            <!-- Data Deletion -->
            <section>
              <h3 class="text-headline mb-4 flex items-center gap-2">
                <span>ğŸ—‘ï¸</span>
                <span data-i18n="dataDeletion">ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</span>
              </h3>
              <div class="card">
                <div class="card-body">
                  <button class="btn btn-danger w-full mb-4" @click="deleteAllData()">
                    <span>âš ï¸</span>
                    <span data-i18n="deleteAllData">ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤</span>
                  </button>
                  <div class="text-caption p-3 rounded" style="background: var(--color-error); color: var(--color-error);">
                    <div class="mb-2">
                      <span>â„¹ï¸</span>
                      <span data-i18n="deleteAllDataInfo">ä»¥ä¸‹ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™:</span>
                    </div>
                    <ul class="list-disc list-inside space-y-1 ml-4">
                      <li data-i18n="websiteList">ã‚µã‚¤ãƒˆä¸€è¦§</li>
                      <li data-i18n="xpathSettings">XPathè¨­å®š</li>
                      <li data-i18n="executionHistory">å®Ÿè¡Œå±¥æ­´</li>
                      <li data-i18n="systemSettings">ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</li>
                      <li data-i18n="masterPassword">ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</li>
                    </ul>
                  </div>
                </div>
              </div>
            </section>

          </div>
        </div>

      </div>
    </main>

    <!-- Action Bar -->
    <div class="sticky bottom-0 p-4 border-t" style="border-color: var(--color-outline-variant); background: var(--color-surface);">
      <div class="container flex justify-end gap-3">
        <button class="btn btn-secondary" @click="resetSettings()">
          <span>ğŸ”„</span>
          <span data-i18n="reset">ãƒªã‚»ãƒƒãƒˆ</span>
        </button>
        <button class="btn btn-primary" @click="saveSettings()">
          <span>ğŸ’¾</span>
          <span data-i18n="save">ä¿å­˜</span>
        </button>
      </div>
    </div>

  </div>

  <script>
    // Theme detection
    function detectTheme() {
      const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    }
    
    // Initial theme detection
    detectTheme();
    
    // Listen for theme changes
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', detectTheme);

    function systemSettingsApp() {
      return {
        activeTab: 'general',
        settings: {
          language: 'ja',
          theme: 'light',
          notifications: {
            onComplete: true,
            onError: true,
            onLongRunning: true,
            sound: 'enabled'
          },
          display: {
            autoRefresh: true,
            debugMode: false,
            historyRetention: '30'
          },
          retry: {
            count: '3',
            minWait: 30,
            maxWait: 60
          },
          security: {
            autoLock: {
              enabled: true,
              timeout: '15',
              onBrowserClose: true
            },
            encryption: {
              enabled: false
            },
            clipboard: {
              autoClear: false
            },
            backup: {
              location: 'local'
            }
          }
        },

        init() {
          this.loadSettings();
        },

        async loadSettings() {
          // Load settings from storage
          console.log('Loading settings...');
        },

        async saveSettings() {
          // Save settings to storage
          console.log('Saving settings...', this.settings);
          // Show success toast
          this.showToast('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
        },

        resetSettings() {
          if (confirm('è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
            // Reset to defaults
            this.init();
            this.showToast('è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'info');
          }
        },

        importSettings() {
          // Open file picker for import
          console.log('Import settings');
        },

        exportSettings() {
          // Export settings as JSON
          console.log('Export settings');
        },

        changeMasterPassword() {
          // Open master password change modal
          console.log('Change master password');
        },

        removeMasterPassword() {
          if (confirm('ãƒã‚¹ã‚¿ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            console.log('Remove master password');
          }
        },

        deleteAllData() {
          if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
            console.log('Delete all data');
          }
        },

        showToast(message, type = 'info') {
          // Show toast notification
          console.log(`Toast: ${message} (${type})`);
        }
      };
    }
  </script>
</body>
</html>
