#!/bin/sh
set -e

echo "ğŸš€ Pre-push quality checks starting..."

echo "ï¿½ RRunning type check..."
npm run type-check

echo "ğŸ“Š Running complexity check..."
npm run complexity

echo "ğŸ—ï¸ Running architecture compliance check..."
npm run lint:architecture

echo "ğŸ”„ Checking for circular dependencies..."
npm run analyze:circular

echo "ğŸ§ª Running tests for changed files..."
# å¤‰æ›´ã•ã‚ŒãŸTypeScriptãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢é€£ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
git diff --name-only HEAD~1 HEAD | grep '\.ts$' | grep -v '\.test\.ts$' | head -5 | xargs -I {} dirname {} | sort | uniq | xargs -I {} npm test -- --testPathPattern="{}" --passWithNoTests --silent

echo "ğŸ’¡ Tip: ã‚ˆã‚Šè©³ç´°ãªå“è³ªãƒã‚§ãƒƒã‚¯ã¯Kiroã® 'âœ… å“è³ªã‚²ãƒ¼ãƒˆå®Ÿè¡Œ' Hookã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„"
echo "ğŸ’¡ Tip: ã‚³ãƒŸãƒƒãƒˆå‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¯Kiroã® 'ğŸ” ã‚³ãƒŸãƒƒãƒˆå‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œ' Hookã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„"

echo "âœ… Pre-push checks passed!"
